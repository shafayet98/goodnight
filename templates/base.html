<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    {% block head %} {% endblock %}
</head>
<body>
  <h1>GPT-3 Story Generator</h1>
  <form action="/" method="post">
      <label for="input_value">Enter your prompt:</label><br>
      <textarea id="input_value" name="input_value" rows="4" cols="50"></textarea><br>
      <input type="submit" value="Submit">
  </form>
  <div id="story_content">
      <!-- Story content will be loaded here -->
  </div>
  <script>
      const storyContent = document.getElementById('story_content');
      const form = document.querySelector('form');

      form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const input_value = document.getElementById('input_value').value;

          const response = await fetch('/', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: `input_value=${encodeURIComponent(input_value)}`
          });

          const reader = response.body.getReader();
          let decoder = new TextDecoder();
          let partialChunk = '';
          while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              const chunk = decoder.decode(value, { stream: true });
              partialChunk += chunk;
              const lines = partialChunk.split('\n\n');
              partialChunk = lines.pop();
              for (const line of lines) {
                  storyContent.innerHTML += '<p>' + line + '</p>';
              }
          }
      });
  </script>
</body>
</html>